{% block stylesheets %}
	<link href="https://transloadit.edgly.net/releases/uppy/v1.19.2/uppy.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>
	<style>
		label {
			text-align: left !important;
		}
		.preview-images-zone {
			width: 100%;
			border: 1px solid #ddd;
			min-height: 180px;
			/* display: flex; */
			padding: 5px 5px 0;
			position: relative;
			overflow: auto;
		}

		.preview-images-zone>.preview-image:first-child {
			height: 185px;
			width: 40%;
			position: relative;
			margin-right: 5px;
		}

		.preview-images-zone > .preview-image {
			height: 185px;
			width: 40%;
			position: relative;
			margin-right: 5px;
			float: left;
			margin-bottom: 5px;
		}

		.preview-images-zone > .preview-image > .image-zone {
			width: 100%;
			height: 100%;
		}

		.preview-images-zone > .preview-image > .image-zone > img {
			width: 100%;
			height: 100%;
		}

		.preview-images-zone > .preview-image > .tools-edit-image {
			position: absolute;
			z-index: 100;
			color: #fff;
			bottom: 0;
			width: 100%;
			text-align: center;
			margin-bottom: 10px;
			display: none;
		}

		.preview-images-zone > .preview-image > .image-cancel {
			text-align: center;
			font-size: 18px;
			top: 0;
			width: 100%;
			right: 0;
			font-weight: bold;
			margin-right: 10px;
			cursor: pointer;
			display: none;
			z-index: 100;
		}

		.preview-image:hover > .image-zone {
			cursor: move;
			opacity: .5;
		}

		.preview-image:hover>.tools-edit-image,
		.preview-image:hover > .image-cancel {
			display: block;
		}

		.ui-sortable-helper {
			width: 90px !important;
			height: 90px !important;
		}

		.container {
			padding-top: 50px;
		}
	</style>
{% endblock %}
{% block body %}
	{% include('back_end/index.html.twig') %}
	<div class="page-wrapper">
		<div style="height: 7%;">
			<h4 class="page-title" style="margin-left: 15px;padding-top: 20px;">Ajouter un Evenement</h4>
		</div>
		<div class="container-fluid" style="    height: 100%;">
			<form method="post" action="{{ path('AddEvenement') }}" enctype="multipart/form-data">
				<div class="card" style="width: 95%;height: 70%;align-items: center;border-radius: 25px;">
					<div class="card-body" style="width: 80%;height: 0%;">
					{% if Evenement != null %} 
					<input name="id" type="hidden" value="{{ Evenement.id }}">
					{% endif %}
						<div class="form-group row">
							<label for="fname" class="col-sm-3  control-label col-form-label">
								<i class="mdi mdi-cursor-text"></i>
								Titre :</label>
							<div class="col-sm-9">
								<input type="text" class="form-control" id="p1" name="title" placeholder="First Name Here" {% if Evenement != null %} value="{{ Evenement.titre }}" {% endif %}>
							</div>
						</div>
						<div class="form-group row">
							<label for="cono1" class="col-sm-3  control-label col-form-label">
								<i class="mdi mdi-file-document-box"></i>
								Adresse :
							</label>
							<div class="col-sm-9">
								<input type="text" class="form-control" id="p1" name="Adresse" placeholder="Rabat , cym villa M" {% if Evenement != null %} value="{{ Evenement.adresse }}" {% endif %}>
							</div>
						</div>
						{% set price = 0 %}
						<div class="form-group row">
							<label for="cono1" class="col-sm-3  control-label col-form-label">
								<i class="mdi mdi-calendar-clock"></i>
								Date debut / fin :
							</label>
							<div class="col-sm-9">
								<input type="text" name="dates" {% if Evenement != null %} value="{{ Evenement.date.createdAt|date("m/d/Y") }} - {{ Evenement.dateEnd.createdAt|date("m/d/Y") }}" {% endif %}/>
							</div>
						</div>
						<div class="form-group row" style="height: 50%;">
							<label for="cono1" class="col-sm-3  control-label col-form-label" style="height: 100%;">
								<i class="mdi mdi-cart-outline"></i>
								Choix Service :
							</label>
							<div class="col-sm-9" style="height: 100%;">
								<div class="card-body" style="height: 100%;">
									<ul class="list-group" style="height: 100%;overflow-y: auto;">
									<input type="hidden" name="service[]">
									{% for Service in Services %}
									{% set image =   Service.media[0].url |reverse  %}
									
										<li class="list-group-item rounded-0 d-flex align-items-center justify-content-between">
											<div class="custom-control custom-radio">
												<input class="custom-control-input" id="{{Service.id}}" type="checkbox" value="{{Service.prix}}" name="customRadio" {% if  Evenement != null and  Service in Evenement.Services %}checked=""{% endif %}>
												<label class="custom-control-label" for="{{Service.id}}">
													<p class="mb-0">{{Service.titre}}</p>
													<span class="small font-italic text-muted">{{Service.Decription}}</span>
												</label>
											</div>
											<h3>{{Service.prix}} Dh</h3>
											<label for="customRadio1"><img src="{{ image[7:]|reverse }}" alt="" width="60"></label>
										</li>
									{% endfor %}
									</ul>
								</div>
							</div>
						</div>
						<div class="form-group row ">
							<label for="cono1" class="col-sm-3  control-label col-form-label">
								<i class="mdi mdi-cash-multiple"></i>
								Total :
							</label>
							<div class="col-sm-9">
								<div class="row">
									<h4 id="totale">0</h4>
									<h4 style="margin-left:5px;">
										Dh</h4>
								</div>
							</div>
						</div>
					</div>
					<div class="card-footer" style="width: 100%; text-align: center;border-radius: 0px 0px 25px 25px;">
						<button type="submit" class="btn btn-outline-success" style="margin-right:10%;" >Success</button>
						<button type="button" class="btn btn-outline-danger">Danger</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>{% endblock %}{% block javascripts %}
<script src="https://transloadit.edgly.net/releases/uppy/v1.19.2/uppy.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script>
var num = 0 ;
var listeService  = [] ;
$('input[name="dates"]').daterangepicker();



$('.custom-control-input').on("click", function () {
	
if ($(this).is(":checked")) {

listeService.push($(this).attr("id"));
$('input[name="service[]"]').val(listeService);
$('#totale').text(parseInt($('#totale').text()) + parseInt($(this).val()));
num ++ ;
} else {
$('#totale').text(parseInt($('#totale').text()) - parseInt($(this).val()));

for(var i = 0 ; i <= listeService.length ; i ++){
	if(listeService[i] == $(this).attr("id")){
		for(var p = i ; i <= listeService.length ; i ++){
			if(i == listeService.length){
				listeService.length -= 1 ;
			}else{
				listeService[p] = listeService[p+1] ;
			}
		}
		break;
	}
}
$('input[name="service[]"]').val(listeService);
}

});
$(document).ready(function () {
{% for Service in Services %}
	if ($('#'+{{Service.id}}+'').is(":checked")) {
	listeService.push(''+{{Service.id}}+'');
	$('input[name="service[]"]').val(listeService);
	$('#totale').text(parseInt($('#totale').text()) + parseInt($('#'+{{Service.id}}+'').val()));
	num ++ ;
	}
{% endfor %}


document.getElementById('pro-image').addEventListener('change', readImage, false);
$(document).on('click', '.image-cancel', function () {
let no = $(this).data('no');
check();
$(".preview-image.preview-show-" + no).remove();
});
});


var num = 0;
function readImage() {
if (window.File && window.FileList && window.FileReader) {
var files = event.target.files; // FileList object
var output = $(".preview-images-zone");

for (let i = 0; i < files.length; i++) {
var file = files[i];
if (file.type.match('image')) {
var picReader = new FileReader();
if (file.type.match('image')) {

picReader.addEventListener('load', function (event) {
var picFile = event.target;
var html = '<div class="preview-image preview-show-' + num + '">' + '<div class="image-cancel btn-danger" data-no="' + num + '">Supprimer</div>' + '<div class="image-zone"><img id="pro-img-' + num + '" src="' + picFile.result + '" style="object-fit: contain;"></div>' + '</div>';
output.append(html);
num = num + 1;
});
}

picReader.readAsDataURL(file);

} else {
alert('Fichier non supporter');
}
}
// $("#pro-image").val('');
} else {
console.log('Browser not support');
}
}

$('#p1').on('change', function () {
check();
});
$('#p2').on('change', function () {
check();
});
$('#p3').on('change', function () {
check();
});

function check() {
if ($('#p1').val() != "" && $('#p2').val() != "" && $('#p3').val() != "") {
$('.btn-outline-success').prop("disabled", false);
} else {
console.log('no');
}
}

{% if Add == true %}
tata.success('Evenement ajouter avec succes', 'Consulter vos Evenement', {duration: 5000})
{% elseif Update == true %}
tata.success('Service Modifier avec succes', 'Consulter vos services', {duration: 5000}){% endif %}
</script>{% endblock %}
